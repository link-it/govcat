openapi: 3.0.3
info:
  title: "GovCat - OIDC Server"
  description: "OAuth 2.0 Token Server - RFC 6749 / RFC 7009"
  x-summary: "OAuth 2.0 Token Server"
  contact:
    email: "info@link.it"
  version: "1.0.0"
  license:
    name: "GPLv3"
  termsOfService: "https://www.gnu.org/licenses/gpl-3.0.txt"
tags:
- name: "Token"
  description: "OAuth 2.0 Token Operations"
paths:
  /token:
    post:
      tags:
        - Token
      operationId: token
      summary: Issue or refresh an access token
      description: |
        OAuth 2.0 Token Endpoint (RFC 6749).
        Supports the following grant types:
        - client_credentials: Client Credentials Grant
        - authorization_code: Authorization Code Grant
        - refresh_token: Refresh Token Grant
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/TokenRequest'
      responses:
        '200':
          description: Successful token response
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/TokenResponse'
        '400':
          description: Bad Request - Invalid request or grant
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OAuthError'
        '401':
          description: Unauthorized - Invalid client credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OAuthError'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Problem'
  /revoke:
    post:
      tags:
        - Token
      operationId: revoke
      summary: Revoke an access or refresh token
      description: |
        OAuth 2.0 Token Revocation Endpoint (RFC 7009).
        Allows clients to notify the authorization server that a previously
        obtained token is no longer needed.
      requestBody:
        required: true
        content:
          application/x-www-form-urlencoded:
            schema:
              $ref: '#/components/schemas/RevokeRequest'
      responses:
        '200':
          description: Token successfully revoked (or was already invalid)
        '400':
          description: Bad Request - Invalid request
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OAuthError'
        '401':
          description: Unauthorized - Invalid client credentials
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/OAuthError'
        '500':
          description: Internal Server Error
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Problem'
components:
  schemas:
    TokenRequest:
      type: object
      required:
        - grant_type
      properties:
        grant_type:
          type: string
          description: |
            The type of grant being requested.
            - client_credentials: Client Credentials Grant (RFC 6749 Section 4.4)
            - authorization_code: Authorization Code Grant (RFC 6749 Section 4.1)
            - refresh_token: Refresh Token Grant (RFC 6749 Section 6)
          enum:
            - client_credentials
            - authorization_code
            - refresh_token
        client_id:
          type: string
          description: The client identifier issued to the client during registration
        client_secret:
          type: string
          description: The client secret
        code:
          type: string
          description: The authorization code received from the authorization server (for authorization_code grant)
        redirect_uri:
          type: string
          description: The redirect URI used in the authorization request (for authorization_code grant)
        refresh_token:
          type: string
          description: The refresh token issued to the client (for refresh_token grant)
        scope:
          type: string
          description: The scope of the access request (space-delimited list of scopes)
        client_assertion_type:
          type: string
          description: The format of the client assertion (e.g., urn:ietf:params:oauth:client-assertion-type:jwt-bearer)
        client_assertion:
          type: string
          description: A JWT containing a signed assertion about the client identity
        code_verifier:
          type: string
          description: PKCE code verifier (RFC 7636)
    TokenResponse:
      type: object
      required:
        - access_token
        - token_type
      properties:
        access_token:
          type: string
          description: The access token issued by the authorization server
        token_type:
          type: string
          description: The type of the token issued (typically "Bearer")
          example: Bearer
        expires_in:
          type: integer
          format: int64
          description: The lifetime in seconds of the access token
          example: 3600
        refresh_token:
          type: string
          description: The refresh token that can be used to obtain new access tokens
        scope:
          type: string
          description: The scope of the access token (space-delimited list of scopes)
        id_token:
          type: string
          description: The ID token (for OpenID Connect flows)
    RevokeRequest:
      type: object
      required:
        - token
      properties:
        token:
          type: string
          description: The token that the client wants to revoke
        token_type_hint:
          type: string
          description: A hint about the type of the token submitted for revocation
          enum:
            - access_token
            - refresh_token
        client_id:
          type: string
          description: The client identifier
        client_secret:
          type: string
          description: The client secret
        client_assertion_type:
          type: string
          description: The format of the client assertion
        client_assertion:
          type: string
          description: A JWT containing a signed assertion about the client identity
    OAuthError:
      type: object
      required:
        - error
      properties:
        error:
          type: string
          description: A single ASCII error code
          enum:
            - invalid_request
            - invalid_client
            - invalid_grant
            - unauthorized_client
            - unsupported_grant_type
            - invalid_scope
            - unsupported_token_type
        error_description:
          type: string
          description: A human-readable description of the error
        error_uri:
          type: string
          description: A URI identifying a human-readable web page with information about the error
    Problem:
      type: object
      properties:
        type:
          type: string
          description: A URI reference that identifies the problem type
          example: "https://example.com/probs/internal-error"
        title:
          type: string
          description: A short, human-readable summary of the problem type
          example: "Internal Server Error"
        status:
          type: integer
          format: int32
          description: The HTTP status code
          example: 500
        detail:
          type: string
          description: A human-readable explanation specific to this occurrence
        instance:
          type: string
          description: A URI reference that identifies the specific occurrence of the problem
