# ================================================================================
# CONFIGURAZIONE TEST OIDC CON KEYCLOAK
# ================================================================================

# Database H2 in memoria per i test
spring.jpa.hibernate.ddl-auto=create
spring.datasource.url=jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE;MODE=LEGACY
spring.datasource.driverClassName=org.h2.Driver
spring.datasource.username=sa
spring.datasource.password=
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect

# Format SQL queries
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.open-in-view=true
spring.jpa.show-sql=false

# Configurazione Log4j2
logging.config=classpath:log4j2.xml

# Set default locale to English for validation messages
spring.web.locale=en_US
spring.web.locale-resolver=fixed

# ================================================================================
# CONFIGURAZIONE AUTENTICAZIONE OIDC
# ================================================================================

# ModalitÃ  autenticazione: OIDC_JWT
authentication.mode=OIDC_JWT

# Configurazione Keycloak (realm PROVA su localhost:9999)
oidc.jwks.uri=http://localhost:9999/realms/PROVA/protocol/openid-connect/certs
oidc.issuer.uri=http://localhost:9999/realms/PROVA
# Audience opzionale - commentato per test
#oidc.audience=govcat-api

# ================================================================================
# MAPPING CLAIMS JWT -> CAMPI UTENTE
# ================================================================================

# Claims standard Keycloak
oidc.claim.username=preferred_username
oidc.claim.email=email
oidc.claim.firstName=given_name
oidc.claim.lastName=family_name

# Claims custom (se configurati in Keycloak)
oidc.claim.cf=fiscalNumber
oidc.claim.roles=realm_access.roles
oidc.claim.organization=organization
oidc.claim.telefono=phone_number
oidc.claim.sede=sede
oidc.claim.matricola=matricola

# ================================================================================
# CONFIGURAZIONE KEYCLOAK PER TEST
# ================================================================================

# Endpoint Keycloak per ottenere token
keycloak.test.token-endpoint=http://localhost:9999/realms/PROVA/protocol/openid-connect/token
keycloak.test.client-id=govcat-api
keycloak.test.client-secret=
keycloak.test.username=bssgnn
keycloak.test.password=giovannibu

# ================================================================================
# ALTRE CONFIGURAZIONI
# ================================================================================

# Basepath per i servizi REST
spring.mvc.servlet.path=/

# Configurazione ruoli IDM (per mapping ruoli da token)
ruolo_gestore_idm=GESTORE
ruolo_referente_servizio_idm=REFERENTE_SERVIZIO

# Whitelist
whitelist.className=ADMIN_CLASS
